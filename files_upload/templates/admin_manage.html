{% extends "layout.html" %}{% block title %}إدارة المستخدمين{% endblock %}{% block content %}<div class="d-flex align-items-center justify-content-between mb-3"><h5 class="mb-0">إدارة المستخدمين</h5><span class="text-muted">إنشاء مستخدم جديد وإدارة القائمة</span></div><div class="row g-4"><div class="col-lg-6"><div class="card shadow-sm"><div class="card-header bg-primary text-white">إضافة مستخدم</div><div class="card-body"><form method="post" action="{{ url_for('admin') }}" class="vstack gap-3"><input type="hidden" name="next" value="{{ request.path }}"><div class="form-floating"><input type="text" class="form-control" id="newName" name="name" placeholder="الاسم" required><label for="newName">الاسم</label></div><div class="form-floating"><input type="email" class="form-control" id="newEmail" name="email" placeholder="البريد الإلكتروني" required><label for="newEmail">البريد الإلكتروني</label></div><div class="form-floating"><input type="password" class="form-control" id="newPassword" name="password" placeholder="كلمة المرور" required><label for="newPassword">كلمة المرور</label></div><div class="form-floating"><select class="form-select" id="newRole" name="role" required><option value="client">عميل</option><option value="supervisor">مشرف</option></select><label for="newRole">الدور</label></div><button type="submit" class="btn btn-primary">إنشاء</button></form></div></div></div><div class="col-lg-6"><div class="card shadow-sm"><div class="card-header bg-secondary text-white">المستخدمون</div><div class="card-body">{% if users %}<div class="table-toolbar d-flex align-items-center justify-content-between mb-2"><div class="input-group input-group-sm" style="max-width:280px"><span class="input-group-text">بحث</span><input type="text" class="form-control table-search" placeholder="ابحث في الجدول..." data-target="#usersTable"></div></div><div class="table-responsive"><table id="usersTable" class="table table-hover align-middle admin-table"><thead><tr><th>#</th><th>الاسم</th><th>البريد</th><th>الدور</th><th>إجراءات</th></tr></thead><tbody>{% for u in users %}<tr><td>{{ u.id }}</td><td>{{ u.name or '—' }}</td><td>{{ u.email }}</td><td>{{ 'عميل' if u.role=='client' else 'مدير' if u.role=='admin' else 'مشرف' }}</td><td>{% if current_user.id == u.id or u.role == 'admin' %}<button class="btn btn-sm btn-outline-secondary" disabled>حذف</button>{% else %}<form method="post" action="{{ url_for('delete_user', id=u.id) }}" onsubmit="return confirm('هل أنت متأكد من حذف هذا المستخدم؟ سيتم حذف جميع ملفاته أيضاً.');"><input type="hidden" name="next" value="{{ request.path }}"><button type="submit" class="btn btn-sm btn-outline-danger">حذف</button></form>{% endif %}</td></tr>{% endfor %}</tbody></table></div>{% else %}<div class="text-muted">لا يوجد مستخدمون.</div>{% endif %}<div class="col-lg-6"><div class="card shadow-sm"><div class="card-header bg-warning text-dark">تغيير كلمة المرور</div><div class="card-body"><form method="post" action="{{ url_for('admin_change_password') }}" class="vstack gap-3"><input type="hidden" name="next" value="{{ request.path }}"><div class="form-floating"><input type="email" class="form-control" id="changeEmail" name="email" placeholder="البريد الإلكتروني" required><label for="changeEmail">البريد الإلكتروني</label></div><div class="form-floating"><input type="password" class="form-control" id="changePassword" name="new_password" placeholder="كلمة المرور الجديدة" required><label for="changePassword">كلمة المرور الجديدة</label></div><button type="submit" class="btn btn-warning">تغيير كلمة المرور</button></form></div></div></div></div>{% endblock %}